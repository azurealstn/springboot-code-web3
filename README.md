# 코드로 배우는 스프링 부트 웹 프로젝트

이 레포지토리는 `코드로 배우는 스프링 부트 웹 프로젝트` 책을 통하여 공부한 내용을 기록을 남기기 위한 레포지토리입니다.

코드는 책을 보며 예제를 따라한 것이며, 혹여 나중에 필요한 코드가 있다면 이 레포지토리를 참고하기 위해 만들었습니다.

사용한 기술은 다음과 같습니다.

- Spring Boot 2.5.x
- Spring Data JPA
    - Querydsl
- MariaDB
- Spring Security

## M:N(다대다) 매핑관계

**영화와 회원의 관계**

- 한 편의 영화는 여러 회원의 평가가 행해질 수 있다.
- 한 명의 회원은 여러 영화에 대해서 평점을 줄 수 있다.

이 경우 영화와 회원은 각각 독립적인 존재이다.

다대다 관계 설정은 실제로는 중간에 `매핑 테이블`이 하나 추가되는 형태가 된다.

### 매핑 테이블 특징

- 매핑 테이블의 작성 이전에 다른 테이블들이 먼저 존재해야 한다.
- 주로 '명사'가 아닌 '동사'나 '히스토리'에 대한 데이터를 보관하는 용도이다.
- 중간에서 양쪽의 PK를 참조하는 형태로 사용한다.

### (주의)

`@ManyToMany` 양방향 참조를 이용하는데 상당한 주의가 필요하다.  
JPA의 실행에서 가장 중요한 것이 현재 메모리상(영속성 컨텍스트)의 엔티티 객체들의 상태와 데이터베이스의 상태를 동기화시키는 것이라는 점을 생각해보면 하나의 객체를 수정하는 경우에 다른 객체의 상태를 매번 일치시키는 것이 간단하지 않은 작업이다.

그래서 실무에서도 왠만하면 **단방향 참조**를 통해 진행해야 한다.

이번 예제에서도 중간에 직접 매핑 테이블을 설계하고, 매핑 관계를 연결시키는 방식으로 진행할 것이다.

연관 관계를 이용할 경우에는 `JPQL`을 이용하여 `left outer join` 등을 활용할 것이다.

![myerd2](https://user-images.githubusercontent.com/55525868/151738823-236b7867-ca9d-4144-8f43-1950c27aec64.png)

## 필요한 데이터 처리

- 목록화면에서 영화의 제목과 이미지 하나, 영화 리뷰의 평점/리뷰 개수를 출력
- 영화조회화면에서 영화와 영화의 이미지들, 리뷰의 평균점수/리뷰 개수를 같이 출력
- 리뷰에 대한 정보에는 회원의 이메일이나 닉네임과 같은 정보를 같이 출력